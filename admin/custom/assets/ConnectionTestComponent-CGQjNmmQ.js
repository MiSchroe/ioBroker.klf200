import{j as e}from"./ConfigCustomKlf200Set__loadShare__prop_mf_2_types__loadShare__-BFkytvx-.js";import{C as d,a as b}from"./ConfigCustomKlf200Set__loadShare__react__loadShare__-B65upkll.js";import{C as t}from"./ConfigCustomKlf200Set__loadShare___mf_0_mui_mf_1_material__loadShare__-CdkjjOdM.js";import{C as j,i as v}from"./ConfigCustomKlf200Set__mf_v__runtimeInit__mf_v__-BOwikv_I.js";const{loadShare:p}=v,{initPromise:T}=j,y=T.then(s=>p("@iobroker/adapter-react-v5",{customShareInfo:{shareConfig:{singleton:!0,strictVersion:!1,requiredVersion:"*"}}})),$=await y.then(s=>s());var a=$;const I=({testResults:s})=>{const i=t.useTheme();return t.useMediaQuery(i.breakpoints.up("sm"))?e.jsx(t.TableContainer,{children:e.jsxs(t.Table,{children:[e.jsx(t.TableHead,{children:e.jsxs(t.TableRow,{children:[e.jsx(t.TableCell,{align:"left",size:"small",children:a.I18n.t("custom_klf200_test_connection_status_header")}),e.jsx(t.TableCell,{align:"left",children:a.I18n.t("custom_klf200_test_connection_step_name_header")}),e.jsx(t.TableCell,{align:"left",children:a.I18n.t("custom_klf200_test_connection_result_header")}),e.jsx(t.TableCell,{align:"left",children:a.I18n.t("custom_klf200_test_connection_message_header")})]})}),e.jsx(t.TableBody,{children:s.map(n=>e.jsxs(t.TableRow,{sx:{"&:last-child td, &:last-child th":{border:0}},hover:!0,children:[e.jsx(t.TableCell,{align:"center",size:"small",children:n.run?n.success?"✅":"❌":""}),e.jsx(t.TableCell,{align:"left",children:n.stepName}),e.jsx(t.TableCell,{align:typeof n.result=="number"?"right":"left",children:String(n.result??"")}),e.jsx(t.TableCell,{align:"left",children:n.message??""})]},n.stepOrder))})]})}):e.jsx(t.Stack,{divider:e.jsx(t.Divider,{orientation:"horizontal",flexItem:!0}),spacing:1,sx:{marginTop:1,overflow:"auto",height:"100%"},children:s.map(n=>e.jsxs(t.Grid2,{container:!0,children:[e.jsx(t.Grid2,{item:!0,xs:6,display:"flex",justifyContent:"left",alignItems:"left",fontWeight:"bold",children:a.I18n.t("custom_klf200_test_connection_step_name_header")}),e.jsx(t.Grid2,{item:!0,xs:6,children:n.stepName}),e.jsx(t.Grid2,{item:!0,xs:6,display:"flex",justifyContent:"left",alignItems:"left",fontWeight:"bold",children:a.I18n.t("custom_klf200_test_connection_status_header")}),e.jsx(t.Grid2,{item:!0,xs:6,children:n.run?n.success?"✅":"❌":""}),e.jsx(t.Grid2,{item:!0,xs:6,display:"flex",justifyContent:"left",alignItems:"left",fontWeight:"bold",children:a.I18n.t("custom_klf200_test_connection_result_header")}),e.jsx(t.Grid2,{item:!0,xs:6,children:String(n.result??"")}),e.jsx(t.Grid2,{item:!0,xs:6,display:"flex",justifyContent:"left",alignItems:"left",fontWeight:"bold",children:a.I18n.t("custom_klf200_test_connection_message_header")}),e.jsx(t.Grid2,{item:!0,xs:6,children:n.message??""})]},n.stepOrder))})},w={button:{minWidth:150}},K=({adapterName:s,instance:i,socket:l,data:n})=>{const[g,u]=d.useState(!1),[x,f]=d.useState(!1),[C,h]=d.useState([]);d.useEffect(async()=>{const c=(o,r)=>{const _=r?r.val:!1;u(_)};return(async()=>{const o=await l.getState(`system.adapter.${s}.${i}.alive`);o&&o.val!==void 0?u(o.val):u(!1),await l.subscribeState(`system.adapter.${s}.${i}.alive`,c)})().catch(console.error),()=>{l.unsubscribeState(`system.adapter.${s}.${i}.alive`,c)}},[]),d.useEffect(()=>{const c=(o,r)=>{if(o.endsWith(".running")){const _=r?r.val:!1;f(_)}else if(o.endsWith(".testResults")){const _=r?JSON.parse(r.val||"[]"):[];h(_)}};return(async()=>{const o=await l.getState(`${s}.${i}.TestConnection.running`);if(o&&o.val===!0){f(o.val);const r=await l.getState(`${s}.${i}.TestConnection.testResults`);r&&r.val!==void 0&&h(JSON.parse(r.val||"[]"))}else f(!1),l.setState(`${s}.${i}.TestConnection.testResults`,"[]",!0);await l.subscribeState(`${s}.${i}.TestConnection.*`,c)})().catch(console.error),()=>{l.unsubscribeState(`${s}.${i}.TestConnection.*`,c)}},[]);const S=async()=>{try{const c={command:"ConnectionTest",hostname:n.host,password:await l.encrypt(n.password)};n.advancedSSLConfiguration&&(c.advancedSSLConfiguration={sslFingerprint:n.SSLFingerprint,sslPublicKey:n.SSLPublicKey});const m=await l.sendTo(`${s}.${i}`,c.command,c);h(m)}finally{}};return e.jsxs(b.Fragment,{children:[e.jsx(t.Button,{style:w.button,color:"secondary",variant:"contained",disabled:!g||x,onClick:S,children:a.I18n.t("custom_klf200_test_connection_button")}),!g&&e.jsx("p",{children:a.I18n.t("custom_klf200_test_connection_not_alive_hint")}),(x||C.length>0)&&e.jsx(I,{testResults:C})]})};export{K as C,a};
