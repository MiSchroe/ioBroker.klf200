import{j as s}from"./jsx-runtime-CX0gbFi4.js";import{C as _,R as S}from"./ConfigCustomKlf200Set__loadShare__react__loadShare__-DI7P7JuQ.js";import{C as t}from"./ConfigCustomKlf200Set__loadShare___mf_0_mui_mf_1_material__loadShare__-ChDKL2WJ.js";import{C as b,i as j}from"./ConfigCustomKlf200Set__mf_v__runtimeInit__mf_v__-DQsZ6hgT.js";const{loadShare:v}=j,{initPromise:T}=b,k=T.then(e=>v("@iobroker/adapter-react-v5",{customShareInfo:{shareConfig:{singleton:!0,strictVersion:!1,requiredVersion:"*"}}})),y=await k.then(e=>e());var l=y;const x=({testResults:e})=>{const c=t.useTheme();return t.useMediaQuery(c.breakpoints.up("sm"))?s.jsx(t.TableContainer,{children:s.jsxs(t.Table,{children:[s.jsx(t.TableHead,{children:s.jsxs(t.TableRow,{children:[s.jsx(t.TableCell,{align:"left",size:"small",children:l.I18n.t("custom_klf200_test_connection_status_header")}),s.jsx(t.TableCell,{align:"left",children:l.I18n.t("custom_klf200_test_connection_step_name_header")}),s.jsx(t.TableCell,{align:"left",children:l.I18n.t("custom_klf200_test_connection_result_header")}),s.jsx(t.TableCell,{align:"left",children:l.I18n.t("custom_klf200_test_connection_message_header")})]})}),s.jsx(t.TableBody,{children:e.map(n=>s.jsxs(t.TableRow,{sx:{"&:last-child td, &:last-child th":{border:0}},hover:!0,children:[s.jsx(t.TableCell,{align:"center",size:"small",children:n.run?n.success?"✅":"❌":""}),s.jsx(t.TableCell,{align:"left",children:n.stepName}),s.jsx(t.TableCell,{align:typeof n.result=="number"?"right":"left",children:String(n.result??"")}),s.jsx(t.TableCell,{align:"left",children:n.message??""})]},n.stepOrder))})]})}):s.jsx(t.Stack,{divider:s.jsx(t.Divider,{orientation:"horizontal",flexItem:!0}),spacing:1,sx:{marginTop:1,overflow:"auto",height:"100%"},children:e.map(n=>s.jsxs(t.Grid2,{container:!0,children:[s.jsx(t.Grid2,{size:{xs:6},display:"flex",justifyContent:"left",alignItems:"left",fontWeight:"bold",children:l.I18n.t("custom_klf200_test_connection_step_name_header")}),s.jsx(t.Grid2,{size:{xs:6},children:n.stepName}),s.jsx(t.Grid2,{size:{xs:6},display:"flex",justifyContent:"left",alignItems:"left",fontWeight:"bold",children:l.I18n.t("custom_klf200_test_connection_status_header")}),s.jsx(t.Grid2,{size:{xs:6},children:n.run?n.success?"✅":"❌":""}),s.jsx(t.Grid2,{size:{xs:6},display:"flex",justifyContent:"left",alignItems:"left",fontWeight:"bold",children:l.I18n.t("custom_klf200_test_connection_result_header")}),s.jsx(t.Grid2,{size:{xs:6},children:String(n.result??"")}),s.jsx(t.Grid2,{size:{xs:6},display:"flex",justifyContent:"left",alignItems:"left",fontWeight:"bold",children:l.I18n.t("custom_klf200_test_connection_message_header")}),s.jsx(t.Grid2,{size:{xs:6},children:n.message??""})]},n.stepOrder))})},$={button:{minWidth:150}},z=({oContext:e,data:c})=>{const[d,n]=_.useState(!1),[h,f]=_.useState(!1),[g,m]=_.useState([]);_.useEffect(()=>{const r=(a,i)=>{const o=i?i.val:!1;n(o)};return(async()=>{const a=await e.socket.getState(`system.adapter.${e.adapterName}.${e.instance}.alive`);a&&a.val!==void 0?n(a.val):n(!1),await e.socket.subscribeState(`system.adapter.${e.adapterName}.${e.instance}.alive`,r)})().catch(console.error),()=>{e.socket.unsubscribeState(`system.adapter.${e.adapterName}.${e.instance}.alive`,r)}},[]),_.useEffect(()=>{const r=(a,i)=>{if(a.endsWith(".running")){const o=i?i.val:!1;f(o)}else if(a.endsWith(".testResults")){const o=i?JSON.parse(i.val||"[]"):[];m(o)}};return(async()=>{const a=await e.socket.getState(`${e.adapterName}.${e.instance}.TestConnection.running`);if(a&&a.val===!0){f(a.val);const i=await e.socket.getState(`${e.adapterName}.${e.instance}.TestConnection.testResults`);i&&i.val!==void 0&&m(JSON.parse(i.val||"[]"))}else f(!1),await e.socket.setState(`${e.adapterName}.${e.instance}.TestConnection.testResults`,"[]",!0);await e.socket.subscribeState(`${e.adapterName}.${e.instance}.TestConnection.*`,r)})().catch(console.error),()=>{e.socket.unsubscribeState(`${e.adapterName}.${e.instance}.TestConnection.*`,r)}},[]);const p=async()=>{const r={command:"ConnectionTest",hostname:c.host,password:await e.socket.encrypt(c.password)};c.advancedSSLConfiguration&&(r.advancedSSLConfiguration={sslFingerprint:c.SSLFingerprint,sslPublicKey:c.SSLPublicKey});const u=await e.socket.sendTo(`${e.adapterName}.${e.instance}`,r.command,r);m(u)};return s.jsxs(S.Fragment,{children:[s.jsx(t.Button,{style:$.button,color:"secondary",variant:"contained",disabled:!d||h,onClick:p,children:l.I18n.t("custom_klf200_test_connection_button")}),!d&&s.jsx("p",{children:l.I18n.t("custom_klf200_test_connection_not_alive_hint")}),(h||g.length>0)&&s.jsx(x,{testResults:g})]})};export{l as C,z as a};
